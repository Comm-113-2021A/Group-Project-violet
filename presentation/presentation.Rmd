---
title: "Factors of Alcoholism"
subtitle: "in teens"
author: "Team Violet"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(knitr)
library(xaringanthemer)
library(palmerpenguins)
library(showtext)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
student_por <- read.csv("../data/student-por.csv")

student_por <- student_por %>% mutate(Talc=(2/7*(Walc)+5/7*(Dalc)),
       Alcoholism = if_else(Talc < 3, 0, 1),
       Alcoholism = factor(Alcoholism))
```

```{r, include = FALSE}
style_xaringan(
  title_slide_background_image = "presentation/img/confetti.jpg"
)
```


class: left, middle

## A statement of the overall goal / research question

The goal of our research will be to identify the academic and social factors that lead to alcoholism in teenagers. We will then construct a model to identify the likelihood of teenagers to suffer from alcoholism.
---

# Alcoholism in Students

```{r alcoholism-counts, eval = TRUE, echo = FALSE}
count <- student_por %>%
  group_by(Alcoholism) %>%
  count()

count

# student_mat %>%
#   group_by(Alcoholism) %>%
#   count()
```

Roughly `r round(count[2, 2] / (count[1, 2] + count[2, 2]) * 100, 2)`% of students have a total alcohol consumption higher than 3 (out of a max of 5).
---

#Sex

```{r sex, echo= FALSE}
student_por_sex <- student_por %>% 
  select(sex, Talc) %>% 
  group_by(sex) %>%
  summarise(average_talc = mean(Talc))


student_por_sex %>%
  ggplot(mapping = aes(x = sex, y = average_talc)) +
  geom_col() +
  labs(
    title = "Average Total Alcohol Consumption By Sex", 
    x = "Sex", 
    y = "Average Total Alcohol Consumption"
  )


```

---

# Age
```{r age, echo=FALSE, warning=FALSE}

student_por %>%
  ggplot(aes(x=age, y=Talc)) +
  geom_jitter() +
  geom_smooth()

```

---


#Reason
```{r reason, echo=FALSE}
student_por_reason <- student_por %>% 
  select(reason, Talc) %>% 
  group_by(reason) %>%
  summarise(average_talc = mean(Talc))

student_por_reason %>%
  ggplot(mapping = aes(x = reason, y = average_talc)) +
  geom_col() +
  labs(
    title = "Average Total Alcohol Consumption By Reason for Joining School", 
    x = "Reason", 
    y = "Average Total Alcohol Consumption"
  )

```
---

# Parent Cohabitation

```{r Pstatus, echo=FALSE, warning=FALSE}
student_por_Pstatus <- student_por %>% 
  select(Pstatus, Talc) %>% 
  group_by(Pstatus) %>%
  summarise(average_talc = mean(Talc))


student_por_Pstatus %>%
  ggplot(mapping = aes(x = Pstatus, y = average_talc)) +
  geom_col() +
  labs(
    title = "Average Total Alcohol Consumption By Parental Cohabitation Status", 
    x = "Cohabitation Status", 
    y = "Average Total Alcohol Consumption"
  )
```
---
---
# First attempt 
  

---

# Linear Model

We first attempted to create a linear regression model to predict total alcohol consumption with variables we suspected to be associated with total alcohol consumption based on visualizations. 

.pull-left[
```{r new_model}
lin_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Talc ~ school +
        age + 
        failures + 
        freetime + 
        sex +
        Fjob + 
        Mjob +
        reason + 
        studytime +
        famsup +
        goout +
        health +
        absences, data = student_por)
```
]
.pull-right[
```{r} 
tidy(lin_model)
```
]

---
--- 

# Residual Plot

.pull-left[
The residual plot shows obvious problems, as there are distinct negatively sloped lines in the plot.
This may mean that the prediction confidence may be too low, and a artificially low standard error.
]

.pull-right[
```{r resid, out.width="100%", fig.width=5, echo = FALSE}
aug <- augment(lin_model$fit)

aug %>%
  ggplot(mapping = aes(x = .fitted, y = .resid)) +
  geom_jitter() + 
  geom_hline(yintercept = 0)
```
]

---

# Residual Plot Two

```{r linear_reg, echo=FALSE}
lin_model_all <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Talc ~ school +
        sex +
        age + 
        address + 
        famsize + 
        Pstatus + 
        Medu +
        Fedu +
        Mjob + 
        Fjob + 
        reason +
        guardian +
        traveltime +
        studytime +
        failures +
        schoolsup +
        famsup +
        paid +
        activities +
        nursery +
        higher +
        internet +
        romantic +
        famrel +
        freetime +
        goout +
        health +
        absences, data = student_por)
```

.pull-left[
A residual plot of the logistic model with all variables as predictors shows the same trends as the previous one.
]

.pull-right[
```{r resid-all, out.width="100%", fig.width=5, echo = FALSE}
aug2 <- augment(lin_model_all$fit)

aug2 %>%
  ggplot(mapping = aes(x = .fitted, y = .resid)) +
  geom_jitter() + 
  geom_hline(yintercept = 0)
```
]

---

class: inverse, middle, center

# Attempt Two

---

# Logistic Model

A linear model does not work, so we moved to a logistic model to predict alcoholism in students. 
A student is an Alcoholic if they have a total alcohol consumption greater than three. 

.pull-left[
```{r logit-model}
alcoholism_fit <- logistic_reg() %>%
  set_engine("glm") %>%
  fit(Alcoholism ~ school +
        age + 
        failures + 
        freetime + 
        sex +
        Fjob + 
        Mjob +
        reason + 
        studytime +
        famsup +
        goout +
        health +
        absences, data = student_por)
```
]

.pull-right[
```{r} 
tidy(alcoholism_fit)
```
]
---
---

class: inverse, middle, center

# Discussion

---

# Implications



---

# Limitations

Some of the limitations within in our data analysis and results:

1. For the logistic model, the model would have been more accurate if there were more individuals who fell under the Alcoholism factor '1'.

2. The sample was only based on individuals in secondary school taking Portuguese language courses and the school itself is in Portugal. Thus the model should be carefully interpreted for those outside of this demographic.

3. Given the sample was taken within the same school, it is possible that there is slightly non-independence among the observations due to factors like peer pressure.

4. The data set was also independently sourced from https://www.kaggle.com/uciml/student-alcohol-consumption/discussion/206577, and relied on self-reporting alcohol consumption factors.

---

*********** END OF FORMATTING BELOW HERE IS PREVIOUS TRAINNING WITH LINEAR MODEL AND XARGAIN STYLE *********** 

```{r test_train_data}
student_por2 <- student_por %>%
  select(school,
        age,
        failures,
        freetime,
        sex,
        Fjob,
        Mjob,
        reason,
        studytime,
        famsup,
        goout,
        health,
        absences,
        Talc
        )

set.seed(1234)
student_por_pred_split <- initial_split(student_por2)

student_por_pred_train <- training(student_por_pred_split)
student_por_pred_test <- testing(student_por_pred_split)

student_por_pred_rec <- recipe(Talc ~ ., data = student_por_pred_train) %>%
  step_zv(all_predictors())

student_por_model <- linear_reg() %>%
  set_engine("lm")

student_por_pred_workflow <- workflow() %>% add_model(student_por_model) %>% 
  add_recipe(student_por_pred_rec)

student_por_pred_fit <- student_por_pred_workflow %>% 
  fit(data = student_por_pred_train)
student_por_pred_fit

summary(student_por_pred_fit$fit)

student_por_train_pred <- predict(student_por_pred_fit, student_por_pred_train) %>%
  bind_cols(student_por_pred_train %>% select(Talc))

student_por_train_pred

ggplot(data = student_por_train_pred, aes(x=Talc, y=.pred)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
  labs(
    x = "Actual",
    y = "Predicted"
  ) +
  geom_smooth()


```

---

class: inverse, middle, center

# Using xaringan

---

# xaringan

- The presentation is created using the `xaringan` package

- Use `---` to separate slides and `--` for incremental builds

--

- Like this

---

# Layouts

You can use plain text

- or bullet points

.pull-left[
or text in two columns $^*$
]
.pull-right[
- like
- this
]

.footnote[
[*] And add footnotes
]

---

# Code

```{r boring-regression}
# a boring regression
model <- lm(dist ~ speed, data = cars)
tidy(model)
glance(model)
```

---

# Plots

```{r recode-species, echo = FALSE}
# In this chunk I'm doing a bunch of analysis that I don't want to present 
# in my slides. But I need the resulting data frame for a plot I want to present.
iris_modified <- iris %>%
  mutate(Species = fct_other(Species, keep = "setosa"))
```

```{r plot-iris, echo = FALSE}
# Code hidden with echo = FALSE
# Uses modified iris dataset from previous chunk
# Play around with height and width until you're happy with the look
ggplot(data = iris_modified, mapping = aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() + 
  theme_minimal() # theme options: https://ggplot2.tidyverse.org/reference/ggtheme.html
```

---

## Plot and text

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger
ggplot(penguins, aes(x = bill_length_mm, y = species, color = species)) +
  geom_boxplot() +
  theme_minimal()
```
]

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r iris-table, echo = FALSE}
kable(head(iris), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "60%", fig.align = "center", fig.cap = "Image credit: Photo by JÃ¶rg Angeli on Unsplash."}
include_graphics("https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80")
```

Or you can also include a full page image. See next slide.

---

background-image: url(https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80)

---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

# Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
