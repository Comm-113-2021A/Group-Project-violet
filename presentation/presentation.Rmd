---
title: "Factors of Alcoholism In Teens"
subtitle: ""
author: "Team Violet"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(knitr)
library(palmerpenguins)
library(showtext)
library(xaringanthemer)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
student_por <- read.csv("../data/student-por.csv")

student_por <- student_por %>% mutate(Talc=(2/7*(Walc)+5/7*(Dalc)),
       Alcoholism = if_else(Talc < 3, 0, 1),
       Alcoholism = factor(Alcoholism))
```

```{r xaringan-stuff, echo = FALSE}
style_xaringan(
  title_slide_background_image = "title.png",
  title_slide_text_color = "#FFF",
  header_color = "#23395D",
  inverse_background_color = "#23395D",
  inverse_text_color = "#23395D",
  inverse_header_color = "#FFF"
)
```


class: left, middle

## Overall Goal and Basic Research Question

The goal of our research will be to identify the academic and social factors that lead to alcoholism in teenagers. We will then construct a model to identify the likelihood of teenagers to suffer from alcoholism.

---

# Alcoholism in Students

```{r alcoholism-counts, eval = TRUE, echo = FALSE}
count <- student_por %>%
  group_by(Alcoholism) %>%
  count()

count

# student_mat %>%
#   group_by(Alcoholism) %>%
#   count()
```

Roughly `r round(count[2, 2] / (count[1, 2] + count[2, 2]) * 100, 2)`% of students have a total alcohol consumption higher than or equal to 3 (out of a max of 5).
---

#Sex

```{r sex, echo= FALSE}
student_por_sex <- student_por %>% 
  select(sex, Talc) %>% 
  group_by(sex) %>%
  summarise(average_talc = mean(Talc))


student_por_sex %>%
  ggplot(mapping = aes(x = sex, y = average_talc)) +
  geom_col() +
  labs(
    title = "Average Total Alcohol Consumption By Sex", 
    x = "Sex", 
    y = "Average Total Alcohol Consumption"
  )


```

---

# Age
```{r age, echo=FALSE, warning=FALSE}

student_por %>%
  ggplot(aes(x=age, y=Talc)) +
  geom_jitter() +
  geom_smooth()

```

---


#Reason
```{r reason, echo=FALSE}
student_por_reason <- student_por %>% 
  select(reason, Talc) %>% 
  group_by(reason) %>%
  summarise(average_talc = mean(Talc))

student_por_reason %>%
  ggplot(mapping = aes(x = reason, y = average_talc)) +
  geom_col() +
  labs(
    title = "Average Total Alcohol Consumption By Reason for Joining School", 
    x = "Reason", 
    y = "Average Total Alcohol Consumption"
  )

```
---

# Parent Cohabitation

```{r Pstatus, echo=FALSE, warning=FALSE}
student_por_Pstatus <- student_por %>% 
  select(Pstatus, Talc) %>% 
  group_by(Pstatus) %>%
  summarise(average_talc = mean(Talc))


student_por_Pstatus %>%
  ggplot(mapping = aes(x = Pstatus, y = average_talc)) +
  geom_col() +
  labs(
    title = "Average Total Alcohol Consumption By Parental Cohabitation Status", 
    x = "Cohabitation Status", 
    y = "Average Total Alcohol Consumption"
  )
```

---
class: inverse, middle, center

# Attempt: Linear Models

---

# Linear Model

We first attempted to create a linear regression model to predict total alcohol consumption with variables we suspected to be associated with total alcohol consumption based on visualizations. 

The following equation was established from our initial model: 

$$\hat{Total Alcohol Level} = 0.07(MS School) +0.06(Age)+0.03(Failures)-0.02(Free time)+0.54(Male)+$$
$$0.17(FatherJobHealth)+0.11(FatherJobOther)+0.30(FatherJobService)-0.05(FatherJobTeacher)-$$
$$0.24(MotherJobHealth)-0.09(MotherJobOther)-0.04(MotherJobService)+0.05(MotherJobTeacher)+$$
$$0.12(ReasonHome)+0.29(ReasonOther)+0.005(ReasonReputation)-0.081(StudyTime)+$$
$$0.03(FamilySupportYes)+0.23(GoingOut)+0.04(Health)+0.03(Absences)-0.49$$
This model indicates that holding all other variables constant, a change in one of them would be a change in predicted Total Alcohol level by the related coefficient. The intercept would not be interpretable in this context.

.pull-left[
```{r new_model, echo = FALSE}
lin_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Talc ~ school +
        age + 
        failures + 
        freetime + 
        sex +
        Fjob + 
        Mjob +
        reason + 
        studytime +
        famsup +
        goout +
        health +
        absences, data = student_por)
```
]

---

# Residual Plot One

.pull-left[
The residual plot shows obvious problems, as there are distinct negatively sloped lines in the plot.
This may mean that the prediction confidence may be too low, and a artificially low standard error.
]

.pull-right[
```{r resid, out.width="100%", fig.width=5, echo = FALSE}
aug <- augment(lin_model$fit)

aug %>%
  ggplot(mapping = aes(x = .fitted, y = .resid)) +
  geom_jitter() + 
  geom_hline(yintercept = 0)
```
]

---

# Residual Plot Two

```{r linear_reg, echo=FALSE}
lin_model_all <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Talc ~ school +
        sex +
        age + 
        address + 
        famsize + 
        Pstatus + 
        Medu +
        Fedu +
        Mjob + 
        Fjob + 
        reason +
        guardian +
        traveltime +
        studytime +
        failures +
        schoolsup +
        famsup +
        paid +
        activities +
        nursery +
        higher +
        internet +
        romantic +
        famrel +
        freetime +
        goout +
        health +
        absences, data = student_por)
```

.pull-left[
A residual plot of the logistic model with all variables as predictors shows the same trends as the previous one. This further supports the fact that a linear model would be inapporpiate in this setting.
]

.pull-right[
```{r resid-all, out.width="100%", fig.width=5, echo = FALSE}
aug2 <- augment(lin_model_all$fit)

aug2 %>%
  ggplot(mapping = aes(x = .fitted, y = .resid)) +
  geom_jitter() + 
  geom_hline(yintercept = 0)
```
]

---

class: inverse, middle, center

# Attempt: Logistic Models

---

# Logistic Model

A linear model does not work, so we moved to a logistic model to predict alcoholism in students. 
A student is an Alcoholic if they have a total alcohol consumption greater than or equal to three.

From the regression, the following model was generated:

$$\hat{log(alcoholism)} = 0.39(MSSchool)+0.24(Age)+0.25(Faillures)-0.03(Freetime)+1.49(Male)+$$
$$0.72(FatherJobHealth)+0.31(FatherJobOther)+0.91(FatherJobService)-0.45(FatherJobTeacher)-$$
$$0.83(MotherJobHealth)-0.10(MotherJobOther)-0.33(MotherJobService)+0.41(MotherJobTeacher)+$$
$$0.51(ReasonHome)+0.93(ReasonOther)+0.21(ReasonReputation)-0.21(StudyTime)-$$
$$0.06(FamilySupportYes)+0.54(GoingOut)+0.10(Health)+0.07(Absences)-9.8$$
This model indicates that holding all other factors constant, an increase in one of the variables would result in the log of the odds of being alcoholic by a factor of the related coefficient.

.pull-left[
```{r logit-model, echo = FALSE}
alcoholism_fit <- logistic_reg() %>%
  set_engine("glm") %>%
  fit(Alcoholism ~ school +
        age + 
        failures + 
        freetime + 
        sex +
        Fjob + 
        Mjob +
        reason + 
        studytime +
        famsup +
        goout +
        health +
        absences, data = student_por)
```
]

---

# Assessing Logistic Model #1

```{r}
```

```{r}
```



---

class: inverse, middle, center

# Discussion

---

# Implications

The logistic modeling indicated:

1. As shown by our explanatory data analysis, sex was a major predictor in whether or not someone was alcoholic. Especially for males, the odds of being a alcoholic increases.

2. Interestingly, the father's job also tended to have a greater impact on increasing the odds of being alcoholic, barring Teaching. For fathers who were teachers, odds of becoming alcoholic decreased, while for mothers, increased. Teachers were the only level of Mother's job that was assosciated with an increase of being alcoholic.

---

# Limitations

Some of the limitations within in our data analysis and results:

1. For the logistic model, the model would have been more accurate if there were more individuals who fell under the Alcoholism factor '1'.

2. The sample was only based on individuals in secondary school taking Portuguese language courses and the school itself is in Portugal. Thus the model should be carefully interpreted for those outside of this demographic.

3. Given the sample was taken within the same school, it is possible that there is slightly non-independence among the observations due to factors like peer pressure.

4. The data set was also independently sourced from https://www.kaggle.com/uciml/student-alcohol-consumption/discussion/206577, and relied on self-reporting alcohol consumption factors.

---
class: inverse, middle, center

# Thank You! Questions?


